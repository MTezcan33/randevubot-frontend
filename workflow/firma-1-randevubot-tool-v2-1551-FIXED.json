{
  "name": "firma-1-randevubot-tool-v2-1551-FIXED",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "903de904-7556-4155-98f2-7129e8c14f2f",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "1fed6192-091e-4fd3-9b74-c2c7aac2f18c",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -2416,
        208
      ],
      "webhookId": "whatsapp-appointment-bot"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "companies",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp_number",
              "keyValue": "={{ $json.body.from || '+447513293761' }}"
            }
          ]
        }
      },
      "id": "72e08e89-61b4-4cac-8300-09912532efbe",
      "name": "Get Company by WhatsApp",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2208,
        208
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.id }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "6d0ea3bf-bed8-4a74-9e1f-b81cadc615ac",
      "name": "Company Found?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -2000,
        208
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Tarih:  {{ $('Webhook Trigger').item.json.body.date_time }}\nSaat Dilimi: {{ $('Company Found?').item.json.timezone }}\n\n# MÃœÅTERÄ° BÄ°LGÄ°SÄ°\n\nFirma: {{ $('Get Company by WhatsApp').item.json.name }}\nMÃ¼ÅŸteri Telefonu: {{'+' + $('Webhook Trigger').item.json.body.data.key.remoteJid.replace(/\\D/g, '') }}\nMesaj: {{ $('Webhook Trigger').item.json.body.data.message.conversation }}\nAdres: {{ $json.address }}\n---\n\n# GÃ–REV\n\nMÃ¼ÅŸterinin randevu talebini analiz et ve aÅŸaÄŸÄ±daki tool'larÄ± kullanarak iÅŸle:\n\n1. **Get Company Users**: Uzman listesini Ã§ek\n2. **Get Company Services**: Hizmet listesini Ã§ek\n3. **Get Expert Services**: Hangi uzmanÄ±n hangi hizmetleri yapabildiÄŸini kontrol et\n4. **Get Working Hours**: Ã‡alÄ±ÅŸma saatlerini kontrol et\n5. **Get Company Holidays**: Tatil gÃ¼nlerini kontrol et\n6. **Get All Customers**: MÃ¼ÅŸteriyi bul (telefon numarasÄ±na gÃ¶re)\n7. **Get All Appointments**: Mevcut randevularÄ± kontrol et (Ã§akÄ±ÅŸma iÃ§in)\n8. **Create Customers**: Eger mÃ¼ÅŸterinin kaydÄ± yoksa mÃ¼ÅŸteriyi kaydet\n9. **Create Appointment**: MÃ¼ÅŸteri onayÄ±ndan sonra randevuyu kaydet\n10. **Update Appointment**: MÃ¼ÅŸteri onayÄ±ndan sonra randevuyu gÃ¼ncelle\n11. **Cancel Appointment**: MÃ¼ÅŸteri onayÄ±ndan sonra randevuyu iptal et\n\n---\n\n# ADIM ADIM YAKLAÅIM\n\n## 1. MesajÄ± Anla\n- MÃ¼ÅŸteri hangi dilde konuÅŸuyor? Bunu anladÄ±ktan sonra o dilde kendini tanÄ±t ve nasÄ±l yardÄ±mcÄ± olabileÄŸini sor. (Ã–rnegin TÃ¼rkÃ§e konuÅŸuyorsa: Merhaba. Ben {{ $('Get Company by WhatsApp').item.json.name }} 'in randevu asistanÄ±yÄ±m bugÃ¼n size nasÄ±l yardÄ±mcÄ± olabilirim?)\n- MÃ¼ÅŸteri ne istiyor? (randevu oluÅŸturma/iptal/gÃ¼ncelleme/sorgulama/genel soru)\n- Hangi bilgiler var? (tarih, saat, uzman, hizmet,firma adresi)\n\n## 2. Gerekli Tool'larÄ± Ã‡aÄŸÄ±r\n\n### Randevu OluÅŸturma Ä°Ã§in:\n```\na) Get All Customers â†’ MÃ¼ÅŸteriyi telefon numarasÄ±na gÃ¶re bul eger kaydÄ± yoksa  (isim soyisim telefon numarasÄ± bilgileriyle) \"create customers\" tool u kullanÄ±p kaydet. Sonra randuvu iÅŸlemlerine kaldÄ±ÄŸÄ±n yerden devam et\n\nb) Get Company Users â†’ Uzman listesini al\nc) Get Company Services â†’ Hizmet listesini al\nd) Get Expert Services â†’ UzmanÄ±n istenen hizmetleri yapÄ±p yapamadÄ±ÄŸÄ±nÄ± doÄŸrula\ne) Get All Customers â†’ MÃ¼ÅŸteriyi telefon numarasÄ±na gÃ¶re bul\nf) Get All Appointments â†’ O tarih ve uzman iÃ§in mevcut randevularÄ± kontrol et\ng) Get Working Hours â†’ UzmanÄ±n o gÃ¼n Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol et\nh) Get Company Holidays â†’ O gÃ¼nÃ¼n tatil olup olmadÄ±ÄŸÄ±nÄ± kontrol et\n```\n\n### Randevu Ä°ptali Ä°Ã§in:\n```\na) Get All Appointments â†’ MÃ¼ÅŸterinin randevularÄ±nÄ± bul (Sadece tarihi geÃ§memiÅŸ randevular)\n```\n\n### Genel Sorular Ä°Ã§in:\n```\na) Get Company Services â†’ Hizmet listesi iste\nb) Get Working Hours â†’ Ã‡alÄ±ÅŸma saatleri iste\n```\n\n## 3. Validasyon Yap\n\n### âœ… Randevu OluÅŸturma Kontrolleri:\n- Tarih bugÃ¼nden ileri mi? (GeÃ§miÅŸe dÃ¶nÃ¼k randevu oluÅŸturma, mÃ¼ÅŸteriyi uyar)\n- Tarih 30 gÃ¼nden ileri mi? (bir aydan daha ileriye randevu oluÅŸturma, mÃ¼ÅŸteriyi uyar)\n- Uzman o gÃ¼n Ã§alÄ±ÅŸÄ±yor mu? (Get Working Hours)\n- Uzman o gÃ¼n o saatte Ã¶gle arasÄ±nda mÄ±? (Get Company Users)\n- Uzman istenen hizmeti yapabiliyor mu? (Get Expert Services)\n- O gÃ¼n tatil mi? (Get Company Holidays)\n- Ä°stenen saat Ã§alÄ±ÅŸma saatleri iÃ§inde mi?\n- AynÄ± uzman, aynÄ± tarih ve saatte baÅŸka randevu var mÄ±? (Get All Appointments)\n- Hizmet sÃ¼resi kadar boÅŸluk var mÄ±? (Ã‡oklu hizmet varsa toplam sÃ¼reyi kullan!)\n- MÃ¼ÅŸteri kaydÄ± var mÄ±? (Get All Customers)\n\n### âŒ Hata DurumlarÄ±:\n- **Eksik bilgi:** MÃ¼ÅŸteriden sor (tarih/saat/hizmet)\n- **Dolu saat:** Alternatif saatler Ã¶ner\n- **Tatil gÃ¼nÃ¼:** BaÅŸka tarih Ã¶ner\n- **Ã‡alÄ±ÅŸma dÄ±ÅŸÄ±:** Ã‡alÄ±ÅŸma saatlerini bildir\n\n## 4. JSON YanÄ±t OluÅŸtur\n\n### BaÅŸarÄ±lÄ± Randevu:\n```json\n{\n  \"action_type\": \"create_appointment\",\n  \"success\": true,\n  \"customer_message\": \"Merhaba [Ad], randevun baÅŸarÄ±yla oluÅŸturuldu! ğŸ‰\\n\\nğŸ“… Tarih: [Tarih]\\nğŸ• Saat: [Saat]\\nğŸ‘¤ Uzman: [Uzman]\\nğŸ’‡ Hizmet: [Hizmet]\\nğŸ’° Ãœcret: [Fiyat] TL\\nâ±ï¸ SÃ¼re: [SÃ¼re] dakika\\n\\nRandevunu iptal veya deÄŸiÅŸtirmek istersen bize yazabilirsin.\",\n  \"extracted_data\": {\n    \"date\": \"2025-10-27\",\n    \"time\": \"14:00\",\n    \"expert_id\": \"uuid-from-tool\",\n    \"service_id\": \"uuid-from-tool\",\n    \"customer_id\": \"uuid-from-tool\",\n    \"appointment_id\": null\n  },\n  \"database_action\": {\n    \"operation\": \"create\",\n    \"table\": \"appointments\",\n    \"data\": {\n      \"company_id\": \"{{ $('Get Company by WhatsApp').item.json.id }}\",\n      \"customer_id\": \"uuid-from-tool\",\n      \"expert_id\": \"uuid-from-tool\",\n      \"service_id\": \"uuid-from-tool\",\n      \"date\": \"2025-10-27\",\n      \"time\": \"14:00\",\n      \"status\": \"pending\"\n    }\n  },\n  \"needs_more_info\": false,\n  \"missing_fields\": []\n}\n```\n\n### Eksik Bilgi:\n```json\n{\n  \"action_type\": \"create_appointment\",\n  \"success\": false,\n  \"customer_message\": \"Randevu oluÅŸturmak iÃ§in ÅŸu bilgilere ihtiyacÄ±m var:\\n\\nâ€¢ Hangi tarih ve saat?\\nâ€¢ Hangi hizmet?\\nâ€¢ Hangi uzman?\\n\\nÃ–rnek: 'YarÄ±n saat 15:00 iÃ§in Ali Bey'den saÃ§ kesimi'\",\n  \"extracted_data\": {},\n  \"database_action\": { \"operation\": \"none\" },\n  \"needs_more_info\": true,\n  \"missing_fields\": [\"date\", \"time\", \"service\"]\n}\n```\n\n### Dolu Saat:\n```json\n{\n  \"action_type\": \"create_appointment\",\n  \"success\": false,\n  \"customer_message\": \"Maalesef [Tarih] [Saat] saati dolu.\\n\\nMÃ¼sait saatlerimiz:\\nâ€¢ 11:00\\nâ€¢ 14:00\\nâ€¢ 16:30\\n\\nHangisi uygun?\",\n  \"extracted_data\": { \"date\": \"2025-10-27\" },\n  \"database_action\": { \"operation\": \"none\" },\n  \"needs_more_info\": true\n}\n```\n\n### Tatil:\n```json\n{\n  \"action_type\": \"create_appointment\",\n  \"success\": false,\n  \"customer_message\": \"[Tarih] tarihinde firmamÄ±z kapalÄ± ([Tatil AÃ§Ä±klamasÄ±]).\\n\\nBaÅŸka bir tarih Ã¶nerir misiniz?\",\n  \"database_action\": { \"operation\": \"none\" }\n}\n```\n\n### Ä°ptal:\n```json\n{\n  \"action_type\": \"cancel_appointment\",\n  \"success\": true,\n  \"customer_message\": \"[Tarih] [Saat]'teki randevun iptal edildi. BaÅŸka bir zaman iÃ§in yazabilirsin. ğŸ™‚\",\n  \"extracted_data\": { \"appointment_id\": \"uuid\" },\n  \"database_action\": {\n    \"operation\": \"delete\",\n    \"table\": \"appointments\",\n    \"data\": { \"id\": \"uuid\", \"status\": \"cancelled\" }\n  }\n}\n```\n\n### Genel Sorular:\n```json\n{\n  \"action_type\": \"general_question\",\n  \"success\": true,\n  \"customer_message\": \"Hizmetlerimiz:\\n\\nğŸ’‡ SaÃ§ Kesimi - 30dk - 150 TL\\nğŸ’‡ Sakal - 15dk - 75 TL\\n\\nRandevu iÃ§in 'randevu istiyorum' yaz.\",\n  \"database_action\": { \"operation\": \"none\" }\n}\n```\n\n---\n\n# GET EXPERT SERVICES TOOL\nBu tool hangi uzmanÄ±n hangi hizmetleri yapabileceÄŸini gÃ¶sterir. expert_id ve service_id eÅŸleÅŸmelerini dÃ¶ndÃ¼rÃ¼r.\nÃ–NEMLÄ°: Randevu oluÅŸturmadan Ã¶nce seÃ§ilen uzmanÄ±n istenen TÃœM hizmetleri yapÄ±p yapamadÄ±ÄŸÄ±nÄ± kontrol et!\n\n---\n\n# Ã‡OKLU HÄ°ZMET RANDEVUSU\nMÃ¼ÅŸteri birden fazla hizmet isteyebilir (Ã¶r: Hamam + Kese istiyorum). Bu durumda:\n1. Get Company Services ile tÃ¼m hizmet ID'lerini al\n2. Get Expert Services ile uzmanÄ±n bu hizmetleri yapÄ±p yapamadÄ±ÄŸÄ±nÄ± doÄŸrula\n3. Toplam sÃ¼re = tÃ¼m hizmet sÃ¼relerinin toplamÄ±\n4. Ã‡akÄ±ÅŸma kontrolÃ¼nde toplam sÃ¼reyi kullan (tek hizmet sÃ¼resi deÄŸil!)\n5. Create Appointment'a service_ids olarak virgÃ¼lle ayrÄ±lmÄ±ÅŸ ID'ler gÃ¶nder\n6. MÃ¼ÅŸteriye toplam sÃ¼re ve toplam Ã¼creti bildir\n\n---\n\n# HÄ°ZMET DETAY BÄ°LGÄ°LERÄ°\nHizmetlerin ÅŸu alanlarÄ± olabilir:\n- service_content: Hizmet iÃ§eriÄŸi (hangi iÅŸlemler dahil)\n- preparation_info: HazÄ±rlÄ±k talimatlarÄ± (randevu Ã¶ncesi bilinmesi gerekenler)\n- contraindications: Kontra-endikasyonlar (kimler iÃ§in uygun deÄŸil)\nMÃ¼ÅŸteri sorarsa bu bilgileri paylaÅŸ.\n\n---\n\n# UZMAN EÅLEÅTÄ°RME\nMÃ¼ÅŸteri uzman belirtmezse ve birden fazla hizmet istiyorsa:\n- Get Expert Services ile tÃ¼m hizmetleri yapabilen uzmanlarÄ± filtrele\n- HiÃ§bir uzman tÃ¼m hizmetleri yapamÄ±yorsa mÃ¼ÅŸteriye bildir ve alternatifler sun\n\n---\n\n# Ã–NEMLÄ° KURALLAR\n\n1. âœ… **MÃ¼ÅŸteri hangi dilde konuÅŸuyorsa o dilde cevap ver**\n2. âœ… **Tool'larÄ± akÄ±llÄ±ca kullan** (gereksiz Ã§aÄŸrÄ± yapma)\n3. âœ… **Emoji kullan** ama abartma (ğŸ“…ğŸ•ğŸ‘¤ğŸ’‡ğŸ’°â±ï¸)\n4. âœ… **UUID'leri tool'lardan al** (uydurma)\n5. âœ… **Eksik bilgi varsa sor** (varsayÄ±mda bulunma)\n6. âœ… **ValidasyonlarÄ± yap** (tatil, Ã§alÄ±ÅŸma saati, Ã§akÄ±ÅŸma)\n7. âœ… **JSON formatÄ±nÄ± koru** (markdown code block kullanma)\n8. âœ… **customer_message samimi ve aÃ§Ä±k olsun**\n9. âœ… **database_action.data tÃ¼m gerekli alanlarÄ± iÃ§ermeli**\n10. âœ… **Tarih formatÄ±: YYYY-MM-DD, Saat formatÄ±: HH:MM**\n11. âœ… **MÃ¼ÅŸteriye ilk cevap verirken kendini tanÄ±t. Ã–rnegin (TÃ¼rkÃ§e cevap iÃ§in) \"Merhaba ben AS Holdingin randevu asistanÄ±yÄ±m. Size bugÃ¼n nasÄ±l yardÄ±mcÄ± olabilirim?**\n12. âœ… ** FirmanÄ±n YÃ¶netici bilgilerini, YÃ¶neticinin ve uzmanlarÄ±n yada diÄŸer mÃ¼ÅŸterilerin bilgilerin asla paylaÅŸma**\n13. âœ… **Randevuyu oluÅŸturdurtan sonra son kez mÃ¼ÅŸterinin onayÄ±nÄ± al ve randevuyu sistame kaydet**\n---\n\nÅimdi mÃ¼ÅŸterinin mesajÄ±nÄ± analiz et, gerekli tool'larÄ± Ã§aÄŸÄ±r ve JSON yanÄ±t oluÅŸtur!",
        "options": {
          "systemMessage": "=Sen bir WhatsApp randevu yÃ¶netim asistanÄ±sÄ±n.\n\n## TEMEL GÃ–REVÄ°N\nMÃ¼ÅŸterilerin randevu taleplerini tool'larÄ± kullanarak iÅŸlemek.\n\n## TOOL'LARIN AMACI\n\n### Get Company Users\nFirmadaki uzmanlarÄ± listeler.\n**Output:** Array of experts with id, name, role\n\n### Get Company Services  \nFirmanÄ±n sunduÄŸu hizmetleri listeler (sadece aktif hizmetler).\n**Output:** Array of services with id, description, duration, price, expert_id\n\n### Get Expert Services\nBu tool hangi uzmanÄ±n hangi hizmetleri yapabileceÄŸini gÃ¶sterir. expert_id ve service_id eÅŸleÅŸmelerini dÃ¶ndÃ¼rÃ¼r.\nÃ–NEMLÄ°: Randevu oluÅŸturmadan Ã¶nce seÃ§ilen uzmanÄ±n istenen TÃœM hizmetleri yapÄ±p yapamadÄ±ÄŸÄ±nÄ± kontrol et!\n**Output:** Array of expert-service mappings with expert_id, service_id\n\n### Get Working Hours\nUzmanlarÄ±n Ã§alÄ±ÅŸma saatlerini gÃ¶sterir.\n**Output:** Array with day, is_open, start_time, end_time, expert_id\n\n### Get Company Holidays\nTatil gÃ¼nlerini gÃ¶sterir.\n**Output:** Array with date, description, expert_id\n\n### Get All Customers\nFirmaya kayÄ±tlÄ± mÃ¼ÅŸterileri listeler.\n**Output:** Array of customers with id, name, phone\n\n### Get All Appointments\nMevcut randevularÄ± gÃ¶sterir.\n**Output:** Array of appointments with date, time, expert_id, service_id, customer_id, status\n\n### Create Appointment\nYeni randevularÄ± ekler. Ã‡oklu hizmet durumunda service_ids virgÃ¼lle ayrÄ±lmÄ±ÅŸ UUID'ler olarak gÃ¶nderilir.\n\n### Update Appointment\nRandevularÄ± gÃ¼nceller\n\n### Cancel Appointment\nRandevularÄ± iptal eder (status=iptal olarak gÃ¼nceller, silmez)\n\n## Ã‡OKLU HÄ°ZMET RANDEVUSU\nMÃ¼ÅŸteri birden fazla hizmet isteyebilir (Ã¶r: Hamam + Kese istiyorum). Bu durumda:\n1. Get Company Services ile tÃ¼m hizmet ID'lerini al\n2. Get Expert Services ile uzmanÄ±n bu hizmetleri yapÄ±p yapamadÄ±ÄŸÄ±nÄ± doÄŸrula\n3. Toplam sÃ¼re = tÃ¼m hizmet sÃ¼relerinin toplamÄ±\n4. Ã‡akÄ±ÅŸma kontrolÃ¼nde toplam sÃ¼reyi kullan (tek hizmet sÃ¼resi deÄŸil!)\n5. Create Appointment'a service_ids olarak virgÃ¼lle ayrÄ±lmÄ±ÅŸ ID'ler gÃ¶nder\n6. MÃ¼ÅŸteriye toplam sÃ¼re ve toplam Ã¼creti bildir\n\n## HÄ°ZMET DETAY BÄ°LGÄ°LERÄ°\nHizmetlerin ÅŸu alanlarÄ± olabilir:\n- service_content: Hizmet iÃ§eriÄŸi (hangi iÅŸlemler dahil)\n- preparation_info: HazÄ±rlÄ±k talimatlarÄ± (randevu Ã¶ncesi bilinmesi gerekenler)\n- contraindications: Kontra-endikasyonlar (kimler iÃ§in uygun deÄŸil)\nMÃ¼ÅŸteri sorarsa bu bilgileri paylaÅŸ.\n\n## UZMAN EÅLEÅTÄ°RME\nMÃ¼ÅŸteri uzman belirtmezse ve birden fazla hizmet istiyorsa:\n- Get Expert Services ile tÃ¼m hizmetleri yapabilen uzmanlarÄ± filtrele\n- HiÃ§bir uzman tÃ¼m hizmetleri yapamÄ±yorsa mÃ¼ÅŸteriye bildir ve alternatifler sun\n\n## TÃœRKÃ‡E TARÄ°H/SAAT ANLAMA\n\n- \"BugÃ¼n\" â†’ GÃ¼nÃ¼n tarihi\n- \"YarÄ±n\" â†’ BugÃ¼n + 1 gÃ¼n\n- \"Pazartesi\" â†’ Gelecek Pazartesi\n- \"Ã–ÄŸleden sonra\" â†’ 14:00-16:00 arasÄ± Ã¶ner\n- \"Sabah\" â†’ 09:00-11:00 arasÄ± Ã¶ner\n- \"3'te\" â†’ 15:00\n\n## GÃœN ADLARI (VeritabanÄ±nda Ä°ngilizce)\n- Pazartesi â†’ Monday\n- SalÄ± â†’ Tuesday\n- Ã‡arÅŸamba â†’ Wednesday\n- PerÅŸembe â†’ Thursday\n- Cuma â†’ Friday\n- Cumartesi â†’ Saturday\n- Pazar â†’ Sunday\n\n## VALÄ°DASYON KURALLARI\n\n1. Tarih >= bugÃ¼n\n2. Uzman o gÃ¼n Ã§alÄ±ÅŸÄ±yor mu? (is_open = true)\n3. Saat Ã§alÄ±ÅŸma saatleri iÃ§inde mi? (start_time <= saat < end_time)\n4. Tatil gÃ¼nÃ¼ deÄŸil mi?\n5. Uzman istenen hizmeti yapabiliyor mu? (Get Expert Services ile kontrol et)\n6. AynÄ± saatte baÅŸka randevu yok mu?\n7. Hizmet sÃ¼resi kadar boÅŸluk var mÄ±? (Ã‡oklu hizmet varsa toplam sÃ¼reyi kullan)\n\n## YANIT KURALLARI\n\n- TÃ¼rkÃ§e ve samimi\n- Emoji kullan (ğŸ“…ğŸ•ğŸ‘¤ğŸ’‡)\n- JSON formatÄ±nda dÃ¶n\n- Markdown code block KULLANMA\n- UUID'leri tool'lardan al"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1280,
        192
      ],
      "id": "2927a19a-c7eb-4cd2-aa99-f8a2693b1e19",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.3,
          "topK": 40,
          "topP": 0.95
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1792,
        304
      ],
      "id": "35864825-398c-42bf-a9cf-e42bb9e88ec4",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "8nktYcYKBspNnYZX",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook Trigger').item.json.webhookUrl }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -1600,
        352
      ],
      "id": "f2198b7d-43ab-4d6e-9b1d-6520d9e749a4",
      "name": "Window Buffer Memory"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    success: false,\n    error: 'Company not found',\n    customer_message: 'Bu telefon numarasÄ±na ait firma bulunamadÄ±. LÃ¼tfen firma yetkilisiyle iletiÅŸime geÃ§in.'\n  }\n}];"
      },
      "id": "5f9d0a4a-f711-4a21-b3dc-a93085fa6876",
      "name": "Error - No Company",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2384,
        432
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 404
        }
      },
      "id": "65dce4bf-58fd-4c73-83b6-5a217d92606e",
      "name": "Error Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -2064,
        432
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "company_users",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -2384,
        768
      ],
      "id": "7b8975b3-fab5-44e1-a542-45d79c188522",
      "name": "Get Company Users",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "company_services",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            },
            {
              "keyName": "is_active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -2224,
        768
      ],
      "id": "475bd8ee-248d-4691-be9e-0b50b7dfa654",
      "name": "Get Company Services",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "company_working_hours",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -2080,
        768
      ],
      "id": "e8835ceb-9a00-43a4-9f52-e39f3e904f29",
      "name": "Get Working Hours",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "company_holidays",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1920,
        768
      ],
      "id": "44cf7556-2ded-4014-85fc-8d3e4abf8994",
      "name": "Get Company Holidays",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "customers",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1760,
        768
      ],
      "id": "7edbe9ec-f592-42e5-8bd6-c519d7be50d6",
      "name": "Get All Customers",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "appointments",
        "limit": 100,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            },
            {
              "keyName": "date",
              "condition": "gte",
              "keyValue": "={{ new Date().toISOString().split('T')[0] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1616,
        752
      ],
      "id": "fda9f8fd-12d2-48c0-8aef-5aaf58144f1f",
      "name": "Get All Appointments",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "tableId": "appointments",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "company_id",
              "fieldValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            },
            {
              "fieldId": "customer_id",
              "fieldValue": "={{ $fromAI('customer_id', 'Customer ID from Get All Customers tool', 'string') }}"
            },
            {
              "fieldId": "expert_id",
              "fieldValue": "={{ $fromAI('expert_id', 'Expert ID from Get Company Users tool', 'string') }}"
            },
            {
              "fieldId": "service_id",
              "fieldValue": "={{ $fromAI('service_id', 'Service ID from Get Company Services tool', 'string') }}"
            },
            {
              "fieldId": "date",
              "fieldValue": "={{ $fromAI('date', 'Appointment date in YYYY-MM-DD format', 'string') }}"
            },
            {
              "fieldId": "time",
              "fieldValue": "={{ $fromAI('time', 'Appointment time in HH:MM format', 'string') }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $fromAI('status', 'Appointment status: pending or confirmed', 'string') || 'pending' }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1040,
        784
      ],
      "id": "3875b544-fefd-42f0-be2d-9493573fefea",
      "name": "Create Appointment",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "appointments",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $fromAI('appointment_id', 'Appointment ID from Get All Appointments tool', 'string') }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "date",
              "fieldValue": "={{ $fromAI('date', 'New appointment date in YYYY-MM-DD format (optional)', 'string') }}"
            },
            {
              "fieldId": "time",
              "fieldValue": "={{ $fromAI('time', 'New appointment time in HH:MM format (optional)', 'string') }}"
            },
            {
              "fieldId": "expert_id",
              "fieldValue": "={{ $fromAI('expert_id', 'New expert ID from Get Company Users tool (optional)', 'string') }}"
            },
            {
              "fieldId": "service_id",
              "fieldValue": "={{ $fromAI('service_id', 'New service ID from Get Company Services tool (optional)', 'string') }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $fromAI('status', 'New status: pending, confirmed, or cancelled (optional)', 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -848,
        784
      ],
      "id": "cd433c41-f65a-4c8e-9425-b2124b4f3709",
      "name": "Update Appointment",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "appointments",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $fromAI('appointment_id', 'Appointment ID from Get All Appointments tool to cancel', 'string') }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "iptal"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -576,
        800
      ],
      "id": "f7c4a2e2-420a-429e-b835-6f1cfa734fb4",
      "name": "Cancel Appointment",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "expert_services",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "company_id",
              "condition": "eq",
              "keyValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1440,
        768
      ],
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "Get Expert Services",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "tableId": "customers",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "company_id",
              "fieldValue": "={{ $('Get Company by WhatsApp').item.json.id }}"
            },
            {
              "fieldId": "name",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', `Customer full name in UPPERCASE (e.g., AHMET YILMAZ)`, 'string') }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ '+' + $('Webhook Trigger').item.json.body.data.key.remoteJid.replace(/\\D/g, '') }}"
            },
            {
              "fieldId": "email",
              "fieldValue": "={{ $fromAI('customer_email', 'Customer email address (optional)', 'string') || null }}"
            },
            {
              "fieldId": "notes",
              "fieldValue": "={{ $fromAI('customer_notes', 'Additional notes about customer (optional)', 'string') || null }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1216,
        784
      ],
      "id": "d6d570f1-3e0d-44e6-a9d7-3a4f740e6dca",
      "name": "Create Customers",
      "credentials": {
        "supabaseApi": {
          "id": "5fiEwJtzNrMasDp2",
          "name": "Randevubotnet"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse AI Response - Ã‡OK DÄ°LLÄ° KARAKTER DESTEÄÄ°\n// TÃ¼rkÃ§e, RusÃ§a, Ä°ngilizce, Ukraynaca, Almanca, FransÄ±zca, Ä°spanyolca karakterlerini korur\n\nconst aiOutput = $input.item.json.output;\nlet parsedResponse;\n\ntry {\n  // 1. DURUM: AI zaten JSON objesi dÃ¶ndÃ¼rmÃ¼ÅŸ\n  if (typeof aiOutput === 'object' && aiOutput !== null) {\n    parsedResponse = aiOutput;\n  } \n  // 2. DURUM: AI string dÃ¶ndÃ¼rmÃ¼ÅŸ - JSON mu yoksa dÃ¼z metin mi kontrol et\n  else if (typeof aiOutput === 'string') {\n    const trimmedOutput = aiOutput.trim();\n    \n    // JSON string'i mi kontrol et ('{' veya '[' ile baÅŸlÄ±yor mu?)\n    if (trimmedOutput.startsWith('{') || trimmedOutput.startsWith('[')) {\n      // Markdown code block'larÄ± temizle (UTF-8 karakterlere dokunma!)\n      let cleanJson = trimmedOutput\n        .replace(/```json\\n?/g, '')  // ```json baÅŸlangÄ±cÄ±\n        .replace(/```\\n?/g, '')       // ``` bitiÅŸi\n        .trim();                      // BaÅŸtaki/sondaki boÅŸluklarÄ± temizle\n      \n      // JSON parse et (UTF-8 destekli)\n      parsedResponse = JSON.parse(cleanJson);\n    } \n    // DÃ¼z metin dÃ¶ndÃ¼rmÃ¼ÅŸ (JSON deÄŸil)\n    else {\n      // AI sadece customer_message dÃ¶ndÃ¼rmÃ¼ÅŸ\n      // TÃœM DÄ°LLERDEKÄ° KARAKTERLER KORUNARAK JSON wrapper oluÅŸtur\n      parsedResponse = {\n        action_type: \"unclear\",\n        success: true,\n        customer_message: trimmedOutput,  // UTF-8 karakterler korunur\n        extracted_data: {},\n        database_action: { operation: \"none\" },\n        needs_more_info: false,\n        error_message: null\n      };\n    }\n  }\n  else {\n    throw new Error('Invalid output type');\n  }\n  \n  // Parse baÅŸarÄ±lÄ± - UTF-8 karakterler korunarak output dÃ¶ndÃ¼r\n  return [\n    {\n      json: {\n        action_type: parsedResponse.action_type || \"unclear\",\n        success: parsedResponse.success !== false,\n        customer_message: parsedResponse.customer_message || \"YanÄ±tÄ±nÄ±zÄ± iÅŸleyemedim. LÃ¼tfen tekrar dener misiniz?\",\n        extracted_data: parsedResponse.extracted_data || {},\n        database_action: parsedResponse.database_action || { operation: \"none\" },\n        needs_more_info: parsedResponse.needs_more_info || false,\n        error_message: parsedResponse.error_message || null\n      }\n    }\n  ];\n\n} catch (error) {\n  // Parse hatasÄ± durumunda\n  console.error('Parse error:', error.message);\n  console.error('AI Output:', aiOutput);\n  \n  // EÄŸer AI string dÃ¶ndÃ¼rdÃ¼yse, UTF-8 karakterleri koruyarak kullan\n  if (typeof aiOutput === 'string') {\n    return [\n      {\n        json: {\n          action_type: \"unclear\",\n          success: true,\n          customer_message: aiOutput.trim(),  // TÃœM DÄ°L KARAKTERLERÄ° KORUNUR\n          extracted_data: {},\n          database_action: { operation: \"none\" },\n          needs_more_info: false,\n          error_message: null\n        }\n      }\n    ];\n  }\n  \n  // Tamamen baÅŸarÄ±sÄ±z durumunda\n  return [\n    {\n      json: {\n        action_type: \"error\",\n        success: false,\n        customer_message: \"YanÄ±tÄ±nÄ±zÄ± iÅŸleyemedim. LÃ¼tfen tekrar dener misiniz?\",\n        extracted_data: {},\n        database_action: { operation: \"none\" },\n        needs_more_info: false,\n        error_message: `Parse hatasÄ±: ${error.message}`\n      }\n    }\n  ];\n}\n\n/* \nÃ‡OK DÄ°LLÄ° KARAKTER DESTEÄÄ°:\n\nâœ… TÃœRKÃ‡E: Ã¼, Ã¶, ÅŸ, ÄŸ, Ä±, Ã§, Ä°, Ãœ, Ã–, Å, Ä, Ã‡\n   Ã–rnek: \"Merhaba! Randevunuz oluÅŸturuldu. MÃ¼ÅŸteri: Ahmet YÄ±lmaz\"\n\nâœ… RUSÃ‡A: Ğ°, Ğ±, Ğ², Ğ³, Ğ´, Ğµ, Ñ‘, Ğ¶, Ğ·, Ğ¸, Ğ¹, Ğº, Ğ», Ğ¼, Ğ½, Ğ¾, Ğ¿, Ñ€, Ñ, Ñ‚, Ñƒ, Ñ„, Ñ…, Ñ†, Ñ‡, Ñˆ, Ñ‰, ÑŠ, Ñ‹, ÑŒ, Ñ, Ñ, Ñ\n   Ã–rnek: \"ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, ĞœĞµÑ…Ğ¼ĞµÑ‚ Ğ¢ĞµĞ·Ğ¶Ğ°Ğ½! Ğ¯ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ½Ğ° Ğ¿Ñ€Ğ¸ĞµĞ¼.\"\n\nâœ… UKRAYNACA: Ñ–, Ñ—, Ñ”, Ò‘, Ğ˜, Ğ†, Ğ‡, Ğ„, Ò\n   Ã–rnek: \"ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚! Ğ¯ Ğ¼Ğ¾Ğ¶Ñƒ Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñ‚Ğ¸ Ğ· Ğ·Ğ°Ğ¿Ğ¸ÑĞ¾Ğ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¸Ğ¹Ğ¾Ğ¼.\"\n\nâœ… ALMANCA: Ã¤, Ã¶, Ã¼, ÃŸ, Ã„, Ã–, Ãœ\n   Ã–rnek: \"Hallo! Ich kann Ihnen bei der Terminbuchung helfen. GrÃ¶ÃŸe: 5 Ã„pfel\"\n\nâœ… FRANSIZCA: Ã , Ã¢, Ã§, Ã©, Ã¨, Ãª, Ã«, Ã®, Ã¯, Ã´, Ã¹, Ã», Ã¼, Ã¿, Ã¦, Å“\n   Ã–rnek: \"Bonjour! Je peux vous aider avec la rÃ©servation. CafÃ© Ã  14h.\"\n\nâœ… Ä°SPANYOLCA: Ã¡, Ã©, Ã­, Ã³, Ãº, Ã¼, Ã±, Â¡, Â¿\n   Ã–rnek: \"Â¡Hola! Â¿CÃ³mo puedo ayudarle? MaÃ±ana a las 14:00.\"\n\nâœ… EMOJÄ°: ğŸ˜Š ğŸ‰ ğŸ“… ğŸ• ğŸ‘¤ ğŸ’‡ ğŸ’° â±ï¸ âœ… âŒ\n\nBu kod SADECE markdown code block'larÄ± (```) temizler.\nDÄ°ÄER TÃœM UTF-8 KARAKTERLERÄ° OLDUÄU GÄ°BÄ° KORUR!\n*/"
      },
      "id": "7f0a471b-b12f-4d26-a999-9cc1558bde65",
      "name": "Parse AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -720,
        64
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b574167e-c978-4906-9b16-d81dc33006b0"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "3b9479d0-58e3-460b-a09d-bf9b90a8c6da",
      "name": "Check Operation Type",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -448,
        64
      ]
    },
    {
      "parameters": {
        "jsCode": "// VeritabanÄ± iÅŸlemi gerektirmeyen durumlar iÃ§in\nreturn $input.all();"
      },
      "id": "95f159c9-cc60-45c8-ace0-3f07b6f86654",
      "name": "No Database Operation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        240
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { message: $json.customer_message, success: $json.success, action_type: $json.action_type } }}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "a349f1f7-474d-4ba6-924b-232115e7d040",
      "name": "WhatsApp Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -80,
        64
      ],
      "disabled": true
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Get Company by WhatsApp').item.json.instance_name }}",
        "remoteJid": "={{ $('Webhook Trigger').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $json.customer_message }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -80,
        -112
      ],
      "id": "82aba99c-d33f-44c3-acc1-17e92e549290",
      "name": "Send text1",
      "credentials": {
        "evolutionApi": {
          "id": "wIR6KlP1wJan8RmF",
          "name": "firma1-447823987310"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Get Company by WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Company by WhatsApp": {
      "main": [
        [
          {
            "node": "Company Found?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company Found?": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error - No Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Error - No Company": {
      "main": [
        [
          {
            "node": "Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Company Users": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Company Services": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Working Hours": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Company Holidays": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get All Customers": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get All Appointments": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Expert Services": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Appointment": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update Appointment": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cancel Appointment": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Customers": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Response": {
      "main": [
        [
          {
            "node": "Check Operation Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Operation Type": {
      "main": [
        [
          {
            "node": "WhatsApp Response",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send text1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Database Operation": {
      "main": [
        [
          {
            "node": "WhatsApp Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "347994d0-1fa7-40d6-9445-bf6fa2e0e990",
  "meta": {
    "instanceId": "5bf69624a39d6d53ef656fb05088202362a2f094009339df5426d88d65c85398"
  },
  "id": "ieDvoE30oVuKxa3D",
  "tags": []
}